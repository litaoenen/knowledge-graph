"use strict";(self.webpackChunkknowledge_graph=self.webpackChunkknowledge_graph||[]).push([[906],{312:(t,e,n)=>{n.d(e,{E:()=>i,G:()=>r});var o=n(238);const i=async t=>{const e=(0,o.LF)(t),n=e.Sheets[e.SheetNames[0]];return o.Wp.sheet_to_json(n).map((t=>({id:t["\u7f16\u53f7"],label:t.Name,type:a(t["\u7f16\u53f7"]),difficulty:Number(t.Difficulty_degree)||0,importance:Number(t.Importance_degree)||0,description:t.Description})))},r=async t=>{const e=(0,o.LF)(t),n=e.Sheets[e.SheetNames[0]];return o.Wp.sheet_to_json(n).map((t=>({id:t["\u7f16\u53f7"],label:t.Name,name:t.Label,type:a(t["\u7f16\u53f7"]),difficulty:Number(t["\u96be\u5ea6"])||0,importance:Number(t["\u91cd\u8981\u6027"])||0,description:t["\u63cf\u8ff0"],tag:t["\u6807\u7b7e"]})))},a=t=>{switch(t.length){case 2:return"chapter";case 4:return"section";case 6:return"subsection";case 8:return"point";default:return"detail"}}},906:(t,e,n)=>{n.r(e),n.d(e,{default:()=>p});var o=n(43),i=n(646),r=n(262),a=n.n(r),s=n(312),l=n(579);i.A.use(a());const d=t=>"DS"===t||t.startsWith("DS")&&t.length<=4?"chapter":t.startsWith("DS")&&t.length<=6?"section":t.startsWith("DS")&&t.length<=8?"subsection":t.startsWith("DS")&&t.length<=10?"point":"AB"===t||t.startsWith("AB")&&t.length<=4?"chapter":t.startsWith("AB")&&t.length<=6?"section":t.startsWith("AB")&&t.length<=8?"subsection":t.startsWith("AB")&&t.length<=10?"point":"detail",c={container:{width:"100%",height:"80vh",position:"relative"},loadingContainer:{width:"100%",height:"80vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f9fafb",color:"#2c3e50",borderRadius:"12px",fontSize:"18px"},errorContainer:{width:"100%",height:"80vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#f9fafb",color:"#e74c3c",borderRadius:"12px",fontSize:"18px"}},p=()=>{const t=(0,o.useRef)(null),[e,n]=(0,o.useState)([]),[r,a]=(0,o.useState)([]),[p,h]=(0,o.useState)(!0),[u,g]=(0,o.useState)(null),f=(0,o.useRef)(null),[y,m]=(0,o.useState)(new Set);(0,o.useEffect)((()=>{(async()=>{try{h(!0),g(null);const t=await fetch("/knowledge_graph.xlsx");if(!t.ok)throw new Error("\u77e5\u8bc6\u56fe\u8c31Excel\u6587\u4ef6\u52a0\u8f7d\u5931\u8d25");const e=await t.arrayBuffer(),o=await(0,s.E)(e);if(!o||0===o.length)throw new Error("\u77e5\u8bc6\u56fe\u8c31Excel\u6587\u4ef6\u4e3a\u7a7a\u6216\u683c\u5f0f\u4e0d\u6b63\u786e");n(o);const i=await fetch("/ability_graph.xlsx");if(!i.ok)throw new Error("\u80fd\u529b\u56fe\u8c31Excel\u6587\u4ef6\u52a0\u8f7d\u5931\u8d25");const r=await i.arrayBuffer(),l=await(0,s.G)(r);if(!l||0===l.length)throw new Error("\u80fd\u529b\u56fe\u8c31Excel\u6587\u4ef6\u4e3a\u7a7a\u6216\u683c\u5f0f\u4e0d\u6b63\u786e");a(l)}catch(u){console.error("Failed to load Excel files:",u),g(u instanceof Error?u.message:"\u672a\u77e5\u9519\u8bef")}finally{h(!1)}})()}),[]),(0,o.useEffect)((()=>{if(!t.current||p||u||0===e.length&&0===r.length)return;f.current&&f.current.destroy();const n=[...e.map((t=>({data:{...t,isRoot:"DS"===t.id||t.id.length<=4,type:d(t.id),nodeType:"knowledge"}}))),...r.map((t=>({data:{...t,isRoot:"AB"===t.id||t.id.length<=4,type:d(t.id),nodeType:"ability"}})))],o=(t=>{const e=[];return t.forEach((t=>{if("DS"===t.id||"AB"===t.id)return;let n;(t.id.startsWith("DS")||t.id.startsWith("AB"))&&t.id.length>2&&(n=t.id.slice(0,-2),""===n&&(n=t.id.startsWith("DS")?"DS":"AB"),e.push({data:{source:n,target:t.id,id:`${n}-${t.id}`}}))})),console.log(`\u521b\u5efa\u4e86 ${e.length} \u6761\u8fb9`),e})([...e,...r]),a=(0,i.A)({container:t.current,elements:[...n,...o],style:[{selector:"node",style:{label:"data(label)","text-valign":"center","text-halign":"center","text-margin-y":0,"font-family":"Arial","font-size":"20px",color:"#FFFFFF","text-outline-width":2,"text-outline-color":"#000000","text-outline-opacity":1,"text-background-opacity":0,width:t=>60+90*(t.data("importance")||.5),height:t=>60+90*(t.data("importance")||.5),shape:"ellipse","background-color":t=>{const e=t.data("nodeType"),n=t.data("type");return"knowledge"===e?"chapter"===n||"section"===n?"#3a86ff":"#ff006e":"chapter"===n||"section"===n?"#00b894":"#fdcb6e"},"background-opacity":.85,"border-width":3,"border-color":"#fff","border-opacity":.9,"transition-property":"width, height, background-color, border-color, border-width, opacity","transition-duration":200,"transition-timing-function":"ease-in-out"}},{selector:"edge",style:{width:1.5,"line-color":"rgba(150, 150, 150, 0.7)","curve-style":"bezier",opacity:.8,"target-arrow-shape":"triangle","target-arrow-color":"rgba(150, 150, 150, 0.7)","arrow-scale":.7,"z-index":1,"transition-property":"line-color, width, opacity, target-arrow-color","transition-duration":200}},{selector:"node:hover",style:{width:t=>1.1*(60+90*(t.data("importance")||.5)),height:t=>1.1*(60+90*(t.data("importance")||.5)),"background-opacity":.95,"border-width":5,"border-color":"#fff","border-opacity":1,"text-background-opacity":0,color:"#FFFFFF","text-outline-width":2.5,"text-outline-color":"#000000","text-outline-opacity":1,"font-size":"22px","font-weight":"bold","z-index":999}},{selector:"node:selected",style:{"background-opacity":1,"border-width":5,"border-color":"#f8f32b","border-opacity":1,"text-background-opacity":0,color:"#FFFFFF","text-outline-width":3,"text-outline-color":"#000000","text-outline-opacity":1,"font-size":"24px","font-weight":"bold","z-index":999,width:t=>1.2*(60+90*(t.data("importance")||.5)),height:t=>1.2*(60+90*(t.data("importance")||.5))}}],layout:{name:"preset",fit:!0,padding:50},minZoom:.2,maxZoom:3,wheelSensitivity:.3,zoomingEnabled:!0,userZoomingEnabled:!0,panningEnabled:!0,userPanningEnabled:!0,boxSelectionEnabled:!0,selectionType:"single",autoungrabify:!1,autounselectify:!1});f.current=a,a.on("tap","node",(function(t){var e,n;const o=t.target,i=o.id();null===(e=t.originalEvent)||void 0===e||e.preventDefault(),null===(n=t.originalEvent)||void 0===n||n.stopPropagation(),console.log(`\u8282\u70b9\u70b9\u51fb\u5904\u7406: ${i}`),x(i),a.elements().removeClass("highlighted"),o.addClass("highlighted"),o.connectedEdges().addClass("highlighted"),o.neighborhood("node").addClass("highlighted"),o.animate({style:{width:1.2*o.width(),height:1.2*o.height()},duration:300,easing:"ease-out-cubic"})}));let s=null,l=null,c=null;a.on("grab","node",(function(t){const e=t.target,n=e.id();s=e,l=a.collection(),a.nodes().forEach((t=>{t.id()!==n&&t.id().startsWith(n)&&l.union(t)})),l=a.nodes().filter((t=>t.id()!==n&&t.id().startsWith(n))),c={...e.position()},e.unlock(),l&&l.unlock(),console.log(`\u5f00\u59cb\u62d6\u62fd\u8282\u70b9: ${n}, \u5b50\u8282\u70b9\u6570\u91cf: ${l?l.size():0}`)})),a.on("drag","node",(function(t){const e=t.target;if(!s||e.id()!==s.id()||!c||!l)return;const n=e.position(),o=n.x-c.x,i=n.y-c.y;l.forEach((t=>{const e=t.position();t.position({x:e.x+o,y:e.y+i})})),c={...n}})),a.on("free","node",(function(t){const e=t.target;s&&e.id()===s.id()&&(console.log(`\u7ed3\u675f\u62d6\u62fd\u8282\u70b9: ${e.id()}`),s=null,c=null,l=null)})),a.style().selector(".highlighted").style({"background-color":"#000000","border-color":"#FFD700","border-width":5,"border-opacity":1,opacity:1,"text-background-opacity":0,color:"#FFFFFF","text-outline-width":3,"text-outline-color":"#000000","text-outline-opacity":1,"font-size":"24px","font-weight":"bold","z-index":999,width:t=>1.2*(60+90*(t.data("importance")||.5)),height:t=>1.2*(60+90*(t.data("importance")||.5))}).selector("edge.highlighted").style({"line-color":"#FF4500",width:7,opacity:1,"z-index":999,"target-arrow-color":"#FF4500","arrow-scale":2.5,"line-style":"solid"}).selector("node").style({"transition-property":"opacity, width, height, background-color, border-color, border-width","transition-duration":300,"transition-timing-function":"ease-in-out"}).selector("edge").style({"transition-property":"opacity, width, line-color","transition-duration":300,"transition-timing-function":"ease-in-out"}).update(),a.ready((()=>{const t={},e={};a.edges().forEach((n=>{const o=n.source(),i=n.target(),r=o.id(),a=i.id();r.length<a.length&&(t[r]||(t[r]=[]),t[r].push(i),e[a]=o)}));a.layout({name:"cose-bilkent",animate:!1,animationDuration:0,nodeRepulsion:4500,idealEdgeLength:100,edgeElasticity:.45,nestingFactor:.1,gravity:.25,gravityRange:3.8,nodeDimensionsIncludeLabels:!0}).run(),setTimeout((()=>{(()=>{const e=a.getElementById("DS"),n=a.getElementById("AB"),o=e=>{const n=t[e.id()]||[];let i=n.length;return n.forEach((t=>{i+=o(t)})),i},i=(e,n,r,a,s,l)=>{const d=(t[e.id()]||[]).sort(((t,e)=>t.id().localeCompare(e.id()))),c=(r+a)/2,p=400*(n+1),h=s+p*Math.cos(c),u=l+p*Math.sin(c);if(e.position({x:h,y:u}),d.length>0){const t=d.map((t=>{const e=o(t);return Math.max(1,e)})),e=t.reduce(((t,e)=>t+e),0);let c=r;d.forEach(((o,d)=>{const p=t[d],h=c+p/e*(a-r);i(o,n+1,c,h,s,l),c=h}))}};if(e&&e.position({x:-600,y:0}),n&&n.position({x:600,y:0}),e&&t.DS){const e=t.DS.sort(((t,e)=>t.id().localeCompare(e.id()))),n=e.map((t=>{const e=o(t);return Math.max(1,e)})),r=n.reduce(((t,e)=>t+e),0);let a=0;e.forEach(((t,e)=>{const o=n[e],s=2*Math.PI*(o/r),l=a+s;i(t,0,a,l,-600,0),a=l}))}if(n&&t.AB){const e=t.AB.sort(((t,e)=>t.id().localeCompare(e.id()))),n=e.map((t=>{const e=o(t);return Math.max(1,e)})),r=n.reduce(((t,e)=>t+e),0);let a=0;e.forEach(((t,e)=>{const o=n[e],s=2*Math.PI*(o/r),l=a+s;i(t,0,a,l,600,0),a=l}))}})(),a.fit(void 0,80),a.center(),v(),b(),w()}),100)})),a.on("dblclick",(function(t){(t.target===a||t.target.isEdge())&&a.animation({fit:{eles:a.elements(),padding:50},duration:500,easing:"ease-out-cubic"}).play()}));const h=new ResizeObserver((()=>{f.current&&f.current.resize()}));return h.observe(t.current),()=>{f.current&&(f.current.destroy(),f.current=null),h.disconnect();const t=document.querySelector(".node-tooltip");t&&t.parentNode&&t.parentNode.removeChild(t)}}),[e,r,p,u]),(0,o.useEffect)((()=>{f.current&&(v(),b())}),[y]);const b=()=>{if(!f.current)return;const t=f.current;t.nodes().forEach((e=>{const n=e.id();let o=!1;if("DS"===n){o=t.nodes().filter((t=>{if(t.isNode()){const e=t.id();return e.startsWith("DS")&&"DS"!==e&&e.length<=4}return!1})).length>0}else if("AB"===n){o=t.nodes().filter((t=>{if(t.isNode()){const e=t.id();return e.startsWith("AB")&&"AB"!==e&&e.length<=4}return!1})).length>0}else{o=t.nodes().filter((t=>{if(t.isNode()){const e=t.id();return e.startsWith(n)&&e.length===n.length+2}return!1})).length>0}if(o){const t=y.has(n),o=e.data("originalLabel")||e.data("label");e.data("originalLabel")||e.data("originalLabel",o);const i=o+(t?" \u2212":" +");e.data("label",i)}}))},x=t=>{if(!f.current)return;const e=f.current;e.getElementById(t);let n;n="DS"===t?e.nodes().filter((t=>{if(t.isNode()){const e=t.id();return e.startsWith("DS")&&"DS"!==e&&e.length<=4}return!1})):"AB"===t?e.nodes().filter((t=>{if(t.isNode()){const e=t.id();return e.startsWith("AB")&&"AB"!==e&&e.length<=4}return!1})):e.nodes().filter((e=>{if(e.isNode()){const n=e.id();return n.startsWith(t)&&n.length===t.length+2}return!1})),0!==n.length&&m((e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n}))},v=()=>{if(!f.current)return;const t=f.current;t.batch((()=>{t.nodes().filter((t=>{const e=t.id();return"DS"!==e&&e.startsWith("DS")&&e.length<=4})).forEach((t=>{const e=y.has("DS");t.style("opacity",e?1:0),setTimeout((()=>{f.current&&t.style("display",e?"element":"none")}),300)})),t.nodes().filter((t=>{const e=t.id();return"AB"!==e&&e.startsWith("AB")&&e.length<=4})).forEach((t=>{const e=y.has("AB");t.style("opacity",e?1:0),setTimeout((()=>{f.current&&t.style("display",e?"element":"none")}),300)})),t.nodes().filter((t=>{const e=t.id();return"DS"!==e&&"AB"!==e&&!(e.startsWith("DS")&&e.length<=4)&&!(e.startsWith("AB")&&e.length<=4)})).forEach((t=>{const e=t.id();let n="";(e.startsWith("DS")||e.startsWith("AB"))&&(n=e.slice(0,-2),""===n&&(n=e.startsWith("DS")?"DS":"AB"));let o=y.has(n),i=n;for(;"DS"!==i&&"AB"!==i&&i.length>4&&o;){const t=i.slice(0,-2);o=y.has(t),i=t}o&&(e.startsWith("DS")&&!y.has("DS")||e.startsWith("AB")&&!y.has("AB"))&&(o=!1),t.style("opacity",o?1:0),setTimeout((()=>{f.current&&t.style("display",o?"element":"none")}),300)})),t.getElementById("DS").style("display","element").style("opacity",1),t.getElementById("AB").style("display","element").style("opacity",1),t.edges().forEach((t=>{const e=t.source(),n=t.target(),o=parseFloat(e.style("opacity")),i=parseFloat(n.style("opacity")),r=!isNaN(o)&&o>0,a=!isNaN(i)&&i>0;t.style("opacity",r&&a?.8:0),setTimeout((()=>{f.current&&t.style("display",r&&a?"element":"none")}),300)}))}))},w=()=>{if(!f.current)return;const e=f.current;let n=document.querySelector(".node-tooltip");n||(n=document.createElement("div"),n.className="node-tooltip",n.style.display="none",document.body.appendChild(n));const o=(t,e)=>{if(void 0===t)return"\u672a\u8bbe\u7f6e";let n=String(t);return n.includes(":")&&(n=n.split(":").slice(1).join(":").trim()),n};e.on("mouseover","node",(e=>{var i;const r=e.target,a=r.data(),s=a.nodeType;n.innerHTML="knowledge"===s?`\n          <div class="tooltip-header" style="--dot-color: ${r.style("background-color")}">\n            ${a.label||a.id}\n          </div>\n          <div class="tooltip-content">\n            <div class="tooltip-item">\n              <span class="value">${o(a.id)}</span>\n            </div>\n            <div class="tooltip-item">\n              <span class="label">\u7c7b\u578b:</span>\n              <span class="value">${o(a.type)}</span>\n            </div>\n            <div class="tooltip-item">\n              <span class="label">\u91cd\u8981\u6027:</span>\n              <span class="value">${o(a.importance)}</span>\n            </div>\n            <div class="tooltip-item">\n              <span class="label">\u96be\u5ea6:</span>\n              <span class="value">${o(a.difficulty)}</span>\n            </div>\n            ${a.description?`\n              <div class="tooltip-description">\n                <div class="label">\u63cf\u8ff0:</div>\n                <div class="value">${o(a.description)}</div>\n              </div>\n            `:""}\n          </div>\n        `:`\n          <div class="tooltip-header" style="--dot-color: ${r.style("background-color")}">\n            ${a.label||a.id}\n          </div>\n          <div class="tooltip-content">\n            <div class="tooltip-item">\n              <span class="value">${o(a.id)}</span>\n            </div>\n            ${a.name?`\n              <div class="tooltip-item">\n                <span class="label">\u80fd\u529b:</span>\n                <span class="value">${o(a.name)}</span>\n              </div>\n            `:""}\n            <div class="tooltip-item">\n              <span class="label">\u7c7b\u578b:</span>\n              <span class="value">${o(a.type)}</span>\n            </div>\n            <div class="tooltip-item">\n              <span class="label">\u91cd\u8981\u6027:</span>\n              <span class="value">${o(a.importance)}</span>\n            </div>\n            <div class="tooltip-item">\n              <span class="label">\u96be\u5ea6:</span>\n              <span class="value">${o(a.difficulty)}</span>\n            </div>\n            ${a.tag?`\n              <div class="tooltip-item">\n                <span class="label">\u6807\u7b7e:</span>\n                <span class="value">${o(a.tag)}</span>\n              </div>\n            `:""}\n            ${a.description?`\n              <div class="tooltip-description">\n                <div class="label">\u63cf\u8ff0:</div>\n                <div class="value">${o(a.description)}</div>\n              </div>\n            `:""}\n          </div>\n        `,n.style.display="block";const l=e.renderedPosition||r.renderedPosition(),d=null===(i=t.current)||void 0===i?void 0:i.getBoundingClientRect();if(d){const t=d.left+l.x+20,e=d.top+l.y-30;n.style.left=`${t}px`,n.style.top=`${e}px`;const o=n.getBoundingClientRect(),i=window.innerWidth,r=window.innerHeight;o.right>i&&(n.style.left=t-o.width-40+"px"),o.bottom>r&&(n.style.top=e-o.height+"px")}})),e.on("mouseout","node",(()=>{n.style.display="none"})),e.on("mousemove","node",(e=>{var o;if("none"===n.style.display)return;const i=e.renderedPosition,r=null===(o=t.current)||void 0===o?void 0:o.getBoundingClientRect();if(r&&i){const t=r.left+i.x+20,e=r.top+i.y-30;n.style.left=`${t}px`,n.style.top=`${e}px`;const o=n.getBoundingClientRect(),a=window.innerWidth,s=window.innerHeight;o.right>a&&(n.style.left=t-o.width-40+"px"),o.bottom>s&&(n.style.top=e-o.height+"px")}}))};return p?(0,l.jsx)("div",{style:c.loadingContainer,children:(0,l.jsx)("div",{children:"\u52a0\u8f7d\u4e2d..."})}):u?(0,l.jsx)("div",{style:c.errorContainer,children:(0,l.jsxs)("div",{children:["\u9519\u8bef: ",u]})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("style",{children:"\n  .node-tooltip {\n    position: fixed;\n    background: rgba(15, 23, 42, 0.9);\n    border: none;\n    border-radius: 12px;\n    padding: 16px;\n    color: #fff;\n    font-size: 14px;\n    pointer-events: none;\n    z-index: 1000;\n    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);\n    backdrop-filter: blur(8px);\n    max-width: 300px;\n    animation: tooltip-fade-in 0.2s ease-out;\n    transform-origin: center left;\n  }\n\n  @keyframes tooltip-fade-in {\n    from { opacity: 0; transform: translateY(10px) scale(0.95); }\n    to { opacity: 1; transform: translateY(0) scale(1); }\n  }\n\n  .node-tooltip .tooltip-header {\n    font-size: 18px;\n    font-weight: bold;\n    color: #fff;\n    margin-bottom: 12px;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2);\n    padding-bottom: 8px;\n    display: flex;\n    align-items: center;\n  }\n\n  .node-tooltip .tooltip-header::before {\n    content: '';\n    display: inline-block;\n    width: 8px;\n    height: 8px;\n    border-radius: 50%;\n    background-color: var(--dot-color, #3a86ff);\n    margin-right: 8px;\n  }\n\n  .node-tooltip .tooltip-content {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  }\n\n  .node-tooltip .tooltip-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-family: 'Arial', sans-serif;\n  }\n\n  .node-tooltip .tooltip-item .label {\n    color: rgba(255, 255, 255, 0.7);\n    margin-right: 8px;\n    font-size: 13px;\n  }\n\n  .node-tooltip .tooltip-item .value {\n    color: #fff;\n    font-weight: 500;\n  }\n\n  .node-tooltip .tooltip-description {\n    margin-top: 12px;\n    padding-top: 12px;\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n  }\n\n  .node-tooltip .tooltip-description .label {\n    color: rgba(255, 255, 255, 0.7);\n    margin-bottom: 6px;\n    font-size: 13px;\n  }\n\n  .node-tooltip .tooltip-description .value {\n    color: #fff;\n    line-height: 1.5;\n    font-size: 14px;\n  }\n"}),(0,l.jsx)("div",{ref:t,style:c.container})]})}}}]);
//# sourceMappingURL=906.c0ab0bc5.chunk.js.map